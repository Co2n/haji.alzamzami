<!DOCTYPE html>
<html>

<head>
   <base target="_top">
   <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.dataTables.css" />
   <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
   <script src="https://cdn.datatables.net/2.1.3/js/dataTables.js"></script>

   <script src="https://cdn.datatables.net/rowgroup/1.5.0/js/dataTables.rowGroup.js"></script>
   <script src="https://cdn.datatables.net/rowgroup/1.5.0/js/rowGroup.dataTables.js"></script>

   <script src="https://cdn.datatables.net/buttons/3.1.1/js/dataTables.buttons.js"></script>
   <script src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.dataTables.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
   <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>
   <script src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.html5.min.js"></script>
   <script src="https://cdn.datatables.net/buttons/3.1.1/js/buttons.print.min.js"></script>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.css" />
   <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.bootstrap4.css" />

   <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/1.0.1/css/bulma.min.css" />
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
   <link rel="stylesheet" href="https://cdn.datatables.net/2.1.3/css/dataTables.bulma.css" /> -->
   <style>
      table.dataTable tr.group-end td {
         text-align: right;
         font-weight: normal;
      }

      td.highlight {
         background-color: rgba(var(--dt-row-hover), 0.052) !important;
      }

      .nav li {
         margin: 2px;
      }

      .form-control:valid {
         background-color: #fefec8 !important;
      }
   </style>
</head>

<body>
   <div>
      <div class="row align-items-center">
         <div class="col-6">
            <div class="table-responsive form-group">
               <table class="table" style="width: 100%;">
                  <thead class="thead-dark">
                     <tr>
                        <th class="text-right" scope="col" style="width: 10%;">KOLOM</th>
                        <th scope="col"> PENCARIAN </th>
                     </tr>
                  </thead>
                  <tbody>
                     <tr class="text-right" id="filter_col0" data-column="0">
                        <td>TAHUN</td>
                        <td> <input type="text" class="column_filter form-control" id="col0_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col2" data-column="2">
                        <td>REG</td>
                        <td> <input type="text" class="column_filter form-control" id="col2_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col3" data-column="3">
                        <td>PORSI</td>
                        <td> <input type="text" class="column_filter form-control" id="col3_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col5" data-column="5">
                        <td>NAMA</td>
                        <td> <input type="text" class="column_filter form-control" id="col5_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col6" data-column="6">
                        <td>AYAH</td>
                        <td> <input type="text" class="column_filter form-control" id="col6_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col11" data-column="11">
                        <td>USIA</td>
                        <td> <input type="text" class="column_filter form-control" id="col11_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col12" data-column="12">
                        <td>ALAMAT</td>
                        <td> <input type="text" class="column_filter form-control" id="col12_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col13" data-column="13">
                        <td>DESA</td>
                        <td> <input type="text" class="column_filter form-control" id="col13_filter" required /></td>
                     </tr>
                     <tr class="text-right" id="filter_col14" data-column="14">
                        <td>KECAMATAN</td>
                        <td> <input type="text" class="column_filter form-control" id="col14_filter" required /></td>
                     </tr>
                  </tbody>
               </table>
            </div>
         </div>
         <div class="col-6">
            <div class="dt-container container">
               <div class="dt-layout-row">
                  <ul class="nav nav-pills justify-content-center">
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="0">TAHUN</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="1">URUT</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="2">REG</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="3">PORSI</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="4">PANGGIL</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="5">NAMA</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="6">AYAH</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="7">NAMA
                           LENGKAP</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="8">JENIS KELAMIN</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="9">TEMPAT LHR</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="10">TANGGAL LHR</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="11">USIA</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="12">ALAMAT</a>
                     </li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="13">DESA</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link" aria-pressed="false" data-column="14">KECAMATAN</a></li>
                     <li class="nav-item"><a class="toggle-vis nav-link active" aria-pressed="true" data-column="15">DESA-KEC</a>
                     </li>
                  </ul>
               </div>
            </div>
         </div>
         
      
         
      </div>
   </div>
   <table id="tabelJemaah" class="display nowrap table table-bordered table-striped" style="width:100%">
      <thead>
         <tr>
            <th>TAHUN</th>
            <th>URUT</th>
            <th>REG</th>
            <th>PORSI</th>
            <th></th>
            <th>NAMA</th>
            <th>AYAH</th>
            <th>NAMA LENGKAP</th>
            <th></th>
            <th>TMP LHR</th>
            <th>TGL LHR</th>
            <th>USIA</th>
            <th>ALAMAT</th>
            <th>DESA</th>
            <th>KECAMATAN</th>
            <th>DESA - KEC</th>
         </tr>
      </thead>
   </table>
</body>
<script>
   function filterGlobal(table) {
      let filter = document.querySelector('#global_filter');
      let regex = document.querySelector('#global_regex');
      let smart = document.querySelector('#global_smart');

      // table.search(filter.value, regex.checked, smart.checked).draw();
      table.search(filter.value, false, true).draw();
   }

   function filterColumn(table, i) {
      let filter = document.querySelector('#col' + i + '_filter');
      let regex = document.querySelector('#col' + i + '_regex');
      let smart = document.querySelector('#col' + i + '_smart');

      // table.column(i).search(filter.value, regex.checked, smart.checked).draw();
      table.column(i).search(filter.value, false, true).draw();
   }
   const table = new DataTable('#tabelJemaah', {
      columnDefs: [
         { visible: false, targets: 0 }, //TAHUN
         { visible: false, targets: 1 }, //URUT
         { visible: false, targets: 2 }, //REG
         { visible: false, targets: 5 }, //NAMA
         { visible: false, targets: 6 }, //AYAH
         { visible: false, targets: 8 }, //GENDER
         { visible: false, targets: 9 }, //TMP_LHR
         { visible: false, targets: 10 }, //TGL_LHR
         { visible: false, targets: 13 }, //DESA
         { visible: false, targets: 14 }, //KECAMATAN
      ],
      ajax: {
         // url: '/db.json',
         url: 'https://script.googleusercontent.com/macros/echo?user_content_key=Js6OQ_AthyRUA4zcEdf89qXtmvjJzMRiTZmBqD_utDcB1wlOMYN6-yapb8CCmX1wHD5jVuXhCBm--kSSJCgLSM4lCldoCWFNm5_BxDlH2jW0nuo2oDemN9CCS2h10ox_1xSncGQajx_ryfhECjZEnEzW-dkDqdEvaQ1lNuUzuzNowO7EWtD6rfnr3Fqr6oHmd_TcqYTXVUnUvA-igSaYZa-_9F8yZPInxNGlfhHkr7vE_b6mrjC-7Q&lib=MsRZdlVh3LW7J7letq8msJBG7v3fLeO7-',
         dataSrc: 'data'
      },
      columns: [
         { data: "tahun" }, //0
         { data: "urut" }, //1
         { data: "reg" }, //2
         { data: "porsi" }, //3
         { data: "panggil" }, //4
         { data: "nama" }, //5
         { data: "ayah" }, //6
         { data: "nama lengkap" }, //7
         { data: "gender" }, //8
         { data: "tmp_lhr" }, //9
         { data: "tgl_lhr" }, //10
         { data: "usia" }, //11
         { data: "alamat" }, //12
         { data: "desa" }, //13
         { data: "kecamatan" }, //14
         { data: "desa - kec" } //15
      ],
      rowGroup: {
         dataSrc: 'tahun'
      },

      order: [[3, 'asc']],
      // rowGroup: {
      //    dataSrc: (row) => {
      //       let base = Math.floor(row[3] / 10);

      //       return base + '0 - ' + base + '9';
      //    }
      // },
      Filter: true,
      // stateSave: true,
      info: true,
      ordering: true,
      // select: false,
      paging: false,
      layout: {
         topStart: {
         },
         topEnd: {
            buttons: [
               {
                  extend: 'print',
                  text: 'Print Dokumen',
                  title: 'Data Calon Jemaah Haji Kab. Kuningan',
                  about: "tes",
                  exportOptions: {
                     columns: ':visible'
                  }
               },
               {
                  extend: 'pdfHtml5',
                  text: 'PDF',
                  title: 'Data Calon Jemaah Haji Kab. Kuningan',
                  exportOptions: {
                     columns: ':visible'
                  }
               },
               {
                  extend: 'excelHtml5',
                  text: 'Excel',
                  title: 'Data Calon Jemaah Haji Kab. Kuningan',
                  exportOptions: {
                     columns: ':visible'
                  }
               },
               {
                  extend: 'copyHtml5',
                  text: 'Copy',
                  title: 'Data Calon Jemaah Haji Kab. Kuningan',
                  exportOptions: {
                     columns: ':visible'
                  }
               },
            ]
         },
         bottomEnd: {
            paging: {
               firstLast: true
            }
         }
      },
      // layout: {
      //    topStart: {
      //       searchBuilder: {
      //          tes
      //       }
      //    }
      // }
      // order: [[0, 'asc']],
      // order: [[0, 'desc']],
      // columnDefs: [
      //    {
      //       targets: 7,
      //       render: DataTable.render.date()
      //    }
      // ]
   });
   table.on('mouseenter', 'td', function () {
      let colIdx = table.cell(this).index().column;

      table
         .cells()
         .nodes()
         .each((el) => el.classList.remove('highlight'));

      table
         .column(colIdx)
         .nodes()
         .each((el) => el.classList.add('highlight'));
   });

   document.querySelectorAll('a.toggle-vis').forEach((el) => {
      el.addEventListener('click', function (e) {
         let isExpanded = this.getAttribute('aria-pressed');
         console.log(isExpanded)
         if (isExpanded === 'false') {
            this.setAttribute('class', 'toggle-vis nav-link active');
            this.setAttribute('aria-pressed', 'true');
         }
         if (isExpanded === 'true') {
            this.setAttribute('class', 'toggle-vis nav-link');
            this.setAttribute('aria-pressed', 'false');
         }

         e.preventDefault();

         let columnIdx = e.target.getAttribute('data-column');
         let column = table.column(columnIdx);

         // Toggle the visibility
         column.visible(!column.visible());
      });

   });

   document.querySelectorAll('input.global_filter').forEach((el) => {
      el.addEventListener(el.type === 'text' ? 'keyup' : 'change', () =>
         filterGlobal(table)
      );
   });

   document.querySelectorAll('input.column_filter').forEach((el) => {
      let tr = el.closest('tr');
      let columnIndex = tr.getAttribute('data-column');

      el.addEventListener(el.type === 'text' ? 'keyup' : 'change', () =>
         filterColumn(table, columnIndex)
      );
   });

</script>

</html>